#!/usr/bin/make -f

%:
	dh $@

export LDFLAGS := $(shell dpkg-buildflags --get LDFLAGS) -Wl,--as-needed -Wl,-Bsymbolic

override_dh_auto_configure:
	dh_auto_configure -- \
		--with-unicode-support=libunistring \
		--with-enca \
		--enable-introspection \
		--enable-generic-media-extractor=gstreamer \
		--enable-tracker-fts \
		--enable-upower \
		--enable-tracker-explorer \
		--enable-tracker-search-bar \
		--enable-tracker-needle \
		--enable-tracker-preferences \
		--enable-nautilus-extension \
		--enable-libiptcdata \
		--enable-exempi \
		--enable-libexif \
		--enable-libgif \
		--enable-libjpeg \
		--enable-libtiff \
		--enable-poppler \
		--enable-libgsf \
		--enable-libxml2 \
		--enable-libvorbis \
		--enable-libflac \
		--enable-playlist \
		--enable-libgxps \
		--enable-gtk-doc \
		--disable-unit-tests \
		--disable-network-manager \
		--disable-libsecret \
		--disable-miner-rss \
		--disable-miner-flickr \
		--disable-miner-evolution \
		--disable-miner-thunderbird \
		--disable-miner-firefox \
		--disable-hal \
		--disable-taglib \
		--disable-libosinfo \
		--disable-libcue \
		--disable-qt

override_dh_install:
	dh_install -X.la --list-missing

# Enforce tight shlibs dependencies
override_dh_makeshlibs:
	dh_makeshlibs -V \
		-X/usr/lib/tracker-0.16/ \
		-X/usr/lib/evolution/ \
		-X/usr/lib/nautilus/

override_dh_shlibdeps:
	dh_shlibdeps
	dh_girepository

override_dh_strip:
	dh_strip --dbg-package=tracker-dbg

override_dh_builddeb:
	dh_builddeb -- -Zxz
